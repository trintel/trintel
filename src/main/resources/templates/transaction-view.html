<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:include="layout :: page">

<head>
	<th:block th:fragment="title"><title>Trintel</title></th:block>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>

<body>
	<th:block th:fragment="content">
		<!-- <h1>Actions</h1>
		<p></p>
		<table th:unless="${actions.isEmpty()}">
			<thead>
				<tr>
					<th>message</th>
					<th>actiontype</th>
					<th>initiating company</th>
					<th>initiating student</th>
					<th>date</th>
					<th>time</th>
					<th>amount</th>
					<th>price per pice</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="action : ${actions}">
					<td th:text="${action.message}"></td>
					<td th:text="${action.actiontype.name}"></td>
					<td th:text="${action.initiator.company.name}"></td>
					<td th:text="${action.initiator.forename} + ${action.initiator.surname}"></td>
					<td th:text="${action.date}"></td>
					<td th:text="${action.time}"></td>
					<td th:text="${action.amount}"></td>
					<td th:text="${action.pricePerPiece}"></td>
				</tr>
			</tbody>
		</table>
		<p th:if="${actions.isEmpty()}">No Transactions found.</p>

		<a th:href="@{'/transaction/' + ${transactionID} + '/addAction'}">
			<button type="submit">Add new action</button>
		</a>

		<a th:href="@{'/transaction/' + ${transactionID} + '/addSpeacialAction'}">
			<button type="submit">Add new special  action</button>
		</a> -->

		<h1 th:text="#{transactionProgress}"></h1>
		<h3 class="mb-3" th:text="|${actions[0].transaction.buyer.name} #{buying} ${actions[0].transaction.product} #{from} ${actions[0].transaction.seller.name}|"></h3>
		<!-- Accordion for every action in chosen transaction to visualize transaction progress -->
		<div th:unless="${actions.isEmpty()}">
			<div class="accordion" id="accordionPanelsStayOpenExample">
				<div th:each="action: ${actions}">
					<div class="accordion-item mb-3">
						<!-- Accordion header/button -->
						<h4 class="accordion-header" th:id="'panelsStayOpen-headingOne'+${action.id}">
							<button class="accordion-button" th:classappend="${{action.id == actions[#lists.size(actions)-1].id} ? '':'collapsed'}" th:aria-labelledby="'panelsStayOpen-headingOne'+${action.id}" type="button" data-bs-toggle="collapse" th:data-bs-target="'#panelsStayOpen-collapseOne'+${action.id}" aria-expanded="true" th:aria-controls="'panelsStayOpen-collapseOne'+${action.id}">
								<div th:switch="${action.actiontype.name}">
									<h4 th:case="Request"><div class="badge bg-danger me-3" th:text="#{requestTLV}"></div></h4>
									<h4 th:case="Offer"><div class="badge bg-warning me-3" th:text="#{offerTLV}"></div></h4>
									<h4 th:case="Accept"><div class="badge bg-success me-3" th:text="#{acceptTV}"></div></h4>
									<!-- <h4 th:case="End"><div class="badge bg-light text-dark me-3" th:text="#{endTV}"></div></h4> -->
									<!-- <h4 th:case="Delivery"><div class="badge bg-primary me-3" th:text="#{deliveryTLV}"></div></h4> -->
									<!-- <h4 th:case="Invoicing"><div class="badge bg-dark me-3" th:text="#{invoicingTLV}"></div></h4> -->
									<!-- <h4 th:case="Paid"><div class="badge bg-primary me-3" th:text="#{paidTV}"></div></h4> -->
									<h4 th:case="*"><div class="badge bg-secondary me-3" th:text="${transaction.actions[#lists.size(transaction.actions) - 1].actiontype.name}"></div></h4>
								</div>
								<div>
									<div class="text-muted" style="font-size: 15px" th:text="#{initiatingCompany}"></div>
									<div class="text-black"><h5 class="text-break" th:text="${action.initiator.company.name}"></h5></div>
								</div>
						</h4>
						<!-- Accordion body -->
						<div th:id="'panelsStayOpen-collapseOne'+${action.id}" class="accordion-collapse collapse" th:classappend="${{action.id == actions[#lists.size(actions)-1].id} ? 'show':''}" th:aria-labelledby="'panelsStayOpen-headingOne'+${action.id}">
							<div class="accordion-body d-flex">
								<div class="me-5" sec:authorize="hasRole('ADMIN')">
									<span class="text-muted" style="font-size: 15px" th:text="#{initiatingStudent}"></span>
									<span class="text-black"><h5 th:text="${action.initiator.forename} + ' ' + ${action.initiator.surname}"></h5></span>
								</div>
								<div class="me-5">
									<span class="text-muted" style="font-size: 15px" th:text="#{date}"></span>
									<span class="text-black"><h5 th:text="${action.date}"></h5></span>
								</div>
								<div>
									<span class="text-muted" style="font-size: 15px" th:text="#{time}"></span>
									<span class="text-black"><h5 th:text="${action.time}"></h5></span>
								</div>
							</div>
							<div class="accordion-body d-flex">
								<div class="me-5">
									<span class="text-muted" style="font-size: 15px" th:text="#{amount}"></span>
									<span class="text-black"><h5 th:text="${action.transaction.amount}"></h5></span>
								</div>
								<div th:unless="${action.actiontype.name} == 'Request'" class="me-5">
									<div class="text-muted" style="font-size: 15px" th:text="#{pricePerPiece}"></div>
									<div class="text-black"><h5 th:text="${action.transaction.pricePerPiece}"></h5></div>
								</div>
								<div>
									<span class="text-muted" style="font-size: 15px" th:text="#{message}"></span>
									<span class="text-black"><h5 th:text="${action.message}" class="text-break"></h5></span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- Buttons to react to last action for student -->
			<div sec:authorize="hasRole('STUDENT')">
				<div class="d-flex justify-content-center">
					<div th:each="actiontype: ${actiontypes}">
						<div th:switch="${actiontype.name}">
							<a th:case="Offer" class="btn btn-primary btn-lg me-3" th:text="#{offerNA}" th:href="@{'/transaction/' + ${transactionID} + '/addOffer'}"></a>
							<a th:case="Accept" class="btn btn-success btn-lg me-3" th:text="#{acceptNA}" th:href="@{'/transaction/' + ${transactionID} + '/accept'}" method="post"></a>
							<!-- <a th:case="End" class="btn btn-danger btn-lg me-3" th:text="#{endNA}" th:href="@{'/transaction/' + ${transactionID} + '/cancel'}"></a> -->
							<!-- <a th:case="Delivery" class="btn btn-primary btn-lg me-3" th:text="#{deliveryNA}" th:href="@{'/transaction/' + ${transactionID} + '/addAction'}"></a> -->
							<!-- <a th:case="Invoicing" class="btn btn-primary btn-lg me-3" th:text="#{invoicingNA}" th:href="@{'/transaction/' + ${transactionID} + '/addAction'}"></a> -->
							<!-- <a th:case="Paid" class="btn btn-primary btn-lg me-3" th:text="#{paidNA}" th:href="@{'/transaction/' + ${transactionID} + '/addAction'}"></a> -->
						</div>
					</div>
					<a class="btn btn-primary btn-lg me-3" th:href="@{'/transaction/' + ${transactionID} + '/addAction'}" th:text="#{specialActions}"></a>
				</div>
			</div>
		</div>
		<a name="n"></a>
	</th:block>
</body>
</html>
